<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio V3 - Shareable Link Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
        }
        h2 {
            color: #3498db;
            margin-top: 30px;
        }
        .test-step {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
            border-radius: 4px;
        }
        .expected {
            background: #d4edda;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            color: #155724;
        }
        code {
            background: #e8e8e8;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .warning {
            background: #fff3cd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            color: #856404;
        }
        .link-example {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            word-break: break-all;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <h1>Portfolio Simulator V3 - Shareable Link Testing Guide</h1>
    
    <div class="test-section">
        <h2>Feature Overview</h2>
        <p>The shareable link feature allows users to generate a URL containing their entire simulation state, including:</p>
        <ul>
            <li>Investment goal (natural language or structured input)</li>
            <li>Generated strategy and timeline events</li>
            <li>Property assumptions and financial calculations</li>
            <li>Current view settings (month, real listings preference)</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Test 1: Generate and Share a Basic Simulation</h2>
        
        <div class="test-step">
            <strong>Step 1:</strong> Open Portfolio Simulator V3
            <p>Navigate to: <a href="portfolio-simulator-v3.html" target="_blank">portfolio-simulator-v3.html</a></p>
        </div>
        
        <div class="test-step">
            <strong>Step 2:</strong> Enter a Goal
            <p>Use this example: "Build a portfolio that generates $10K/month within 36 months. I have $50K to start and can save $2K/month."</p>
        </div>
        
        <div class="test-step">
            <strong>Step 3:</strong> Generate Strategy
            <p>Click the "Generate Strategy" button and wait for the strategy to be created.</p>
        </div>
        
        <div class="test-step">
            <strong>Step 4:</strong> Share the Simulation
            <p>Click the "Share" button in the control panel.</p>
        </div>
        
        <div class="expected">
            <strong>Expected Result:</strong>
            <ul>
                <li>A modal appears with the shareable link</li>
                <li>The link is automatically copied to clipboard</li>
                <li>Success message appears: "Shareable link copied to clipboard!"</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>Test 2: Load from Shared Link</h2>
        
        <div class="test-step">
            <strong>Step 1:</strong> Copy the Generated Link
            <p>Use the link from Test 1, or use this example format:</p>
            <div class="link-example">
                https://frameworkrealestatesolutions.com/portfolio-simulator-v3.html?state=N4IgxgNg...
            </div>
        </div>
        
        <div class="test-step">
            <strong>Step 2:</strong> Open in New Browser/Incognito
            <p>Paste the link in a new browser tab or incognito window.</p>
        </div>
        
        <div class="expected">
            <strong>Expected Result:</strong>
            <ul>
                <li>Loading message appears: "Loading shared simulation..."</li>
                <li>Goal input is restored</li>
                <li>Strategy is displayed with same metrics</li>
                <li>Timeline events are populated</li>
                <li>Simulation name shows "(Shared)" suffix</li>
                <li>Success message: "Simulation loaded from shared link!"</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>Test 3: Structured Input Sharing</h2>
        
        <div class="test-step">
            <strong>Step 1:</strong> Toggle to Structured Input
            <p>Check the "Structured Input" toggle</p>
        </div>
        
        <div class="test-step">
            <strong>Step 2:</strong> Fill in Values
            <ul>
                <li>Target Monthly Income: $8,000</li>
                <li>Timeline: 24 months</li>
                <li>Starting Capital: $75,000</li>
                <li>Monthly Savings: $3,000</li>
                <li>Strategy: Aggressive</li>
            </ul>
        </div>
        
        <div class="test-step">
            <strong>Step 3:</strong> Generate and Share
            <p>Generate strategy and click Share button</p>
        </div>
        
        <div class="expected">
            <strong>Expected Result:</strong>
            <p>When loaded from link, structured input mode is active with all values restored correctly.</p>
        </div>
    </div>

    <div class="test-section">
        <h2>Test 4: Advanced State Preservation</h2>
        
        <div class="test-step">
            <strong>Step 1:</strong> Create Complex Simulation
            <ul>
                <li>Generate a strategy</li>
                <li>Change "View at month" to 24</li>
                <li>Enable "Replace with real Detroit listings"</li>
                <li>Modify timeline events manually</li>
            </ul>
        </div>
        
        <div class="test-step">
            <strong>Step 2:</strong> Share and Load
            <p>Share the simulation and load in new window</p>
        </div>
        
        <div class="expected">
            <strong>Expected Result:</strong>
            <ul>
                <li>View month is set to 24</li>
                <li>Real listings checkbox is checked</li>
                <li>Manual timeline modifications are preserved</li>
                <li>All financial calculations match original</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>Edge Cases to Test</h2>
        
        <div class="test-step">
            <strong>1. Empty State:</strong>
            <p>Try sharing without generating a strategy first.</p>
            <div class="expected">Should show error: "Please generate a strategy first before sharing"</div>
        </div>
        
        <div class="test-step">
            <strong>2. Large Timeline:</strong>
            <p>Create a simulation with 50+ timeline events.</p>
            <div class="expected">If URL exceeds 8000 chars, should show: "The simulation data is too large to share via URL"</div>
        </div>
        
        <div class="test-step">
            <strong>3. Invalid Link:</strong>
            <p>Modify the state parameter in URL to be invalid.</p>
            <div class="expected">Should show error: "Invalid or corrupted share link"</div>
        </div>
        
        <div class="test-step">
            <strong>4. Cross-Browser:</strong>
            <p>Share in Chrome, load in Firefox/Safari.</p>
            <div class="expected">Should work identically across browsers</div>
        </div>
    </div>

    <div class="test-section">
        <h2>Technical Details</h2>
        
        <h3>URL Structure</h3>
        <p>The shareable link uses this format:</p>
        <code>https://domain.com/portfolio-simulator-v3.html?state=[compressed-data]</code>
        
        <h3>Compression</h3>
        <p>State is compressed using LZ-String library:</p>
        <ul>
            <li>JSON serialization of state object</li>
            <li>LZ-String compression to ~30% of original size</li>
            <li>URL-safe encoding (base64 variant)</li>
        </ul>
        
        <h3>State Object Contents</h3>
        <pre style="background: #f0f0f0; padding: 10px; border-radius: 4px; overflow-x: auto;">
{
    version: 'v3',
    timestamp: '2024-01-15T10:30:00Z',
    goalInput: '...',
    parsedGoal: {...},
    selectedStrategy: {...},
    timelineData: [...],
    simulationName: '...',
    currentViewMonth: 0,
    useRealListings: false
}</pre>
    </div>

    <div class="test-section">
        <h2>Troubleshooting</h2>
        
        <div class="warning">
            <strong>Common Issues:</strong>
            <ul>
                <li><strong>Clipboard fails:</strong> Some browsers require HTTPS for clipboard API</li>
                <li><strong>Link too long:</strong> Simplify strategy or reduce timeline events</li>
                <li><strong>State doesn't load:</strong> Check browser console for errors</li>
                <li><strong>Missing data:</strong> Ensure all V2/V3 scripts are loaded</li>
            </ul>
        </div>
    </div>
</body>
</html>